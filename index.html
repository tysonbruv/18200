<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tax Owing Tracker</title>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0e0e0e;
    color: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

.app {
    width: 420px;
    background: #161616;
    padding: 24px;
    border-radius: 14px;
    box-shadow: 0 0 40px rgba(0,0,0,0.6);
    max-height: 90vh;
    overflow-y: auto;
}

h1 {
    font-size: 18px;
    margin-bottom: 6px;
    font-weight: 600;
    opacity: 0.9;
}

#fyLabel {
    font-size: 12px;
    opacity: 0.6;
    margin-bottom: 12px;
}

.numbers {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    opacity: 0.85;
    margin-bottom: 10px;
}

.bar-container {
    height: 10px;
    background: #2a2a2a;
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 18px;
}

.bar-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff5f57, #ffb347);
    transition: width 0.25s ease;
}

.controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 16px;
}

input, button {
    background: #0f0f0f;
    border: 1px solid #333;
    color: #fff;
    padding: 8px;
    border-radius: 6px;
    font-size: 13px;
}

button {
    cursor: pointer;
}

button:hover {
    background: #2a2a2a;
}

.section {
    margin-bottom: 14px;
}

.section h2 {
    font-size: 13px;
    opacity: 0.7;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
}

.log-item {
    background: #111;
    padding: 6px 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 13px;
}

.log-top {
    display: flex;
    justify-content: space-between;
}

.desc {
    font-size: 12px;
    opacity: 0.7;
    margin-top: 2px;
}

.delete {
    color: #ff5f57;
    cursor: pointer;
    font-size: 12px;
}

.nav {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
}

.hidden {
    display: none;
}
</style>
</head>

<body>

<div class="app">

<!-- MAIN SCREEN -->
<div id="screen-main">
    <h1>Tax Owing Tracker</h1>
    <div id="fyLabel">Financial Year: —</div>

    <div class="numbers">
        <div>$18,200</div>
        <div id="incomeDisplay">$0</div>
    </div>

    <div class="bar-container">
        <div class="bar-fill" id="barFill"></div>
    </div>

    <div class="controls">
        <input id="amountInput" type="number" placeholder="Amount $" />
        <input id="descInput" type="text" placeholder="Description" />
        <button onclick="addIncome()">Add Income</button>
        <button onclick="addDeduction()">Add Deduction</button>
    </div>

    <div class="section">
        <h2>Income <button onclick="showIncome()">View all</button></h2>
        <div id="incomePreview"></div>
    </div>

    <div class="section">
        <h2>Deductions <button onclick="showDeductions()">View all</button></h2>
        <div id="deductionPreview"></div>
    </div>
</div>

<!-- INCOME LOG -->
<div id="screen-income" class="hidden">
    <div class="nav"><button onclick="showMain()">← Back</button></div>
    <h1>Income Log</h1>
    <div id="incomeLog"></div>
</div>

<!-- DEDUCTION LOG -->
<div id="screen-deduction" class="hidden">
    <div class="nav"><button onclick="showMain()">← Back</button></div>
    <h1>Deduction Log</h1>
    <div id="deductionLog"></div>
</div>

</div>

<script>
const BASE = 18200;
const maxRange = 50000;
const STORAGE_KEY = "taxTrackerFY";

function getFinancialYear() {
    const d = new Date();
    const y = d.getFullYear();
    return d.getMonth() >= 6 ? `${y}-${y + 1}` : `${y - 1}-${y}`;
}

const currentFY = getFinancialYear();
document.getElementById("fyLabel").textContent = `Financial Year: ${currentFY}`;

let store = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
store[currentFY] ||= { incomes: [], deductions: [] };

// keep only current + previous FY
const fyKeys = Object.keys(store).sort();
while (fyKeys.length > 2) delete store[fyKeys.shift()];

let incomes = store[currentFY].incomes;
let deductions = store[currentFY].deductions;

const incomeDisplay = document.getElementById("incomeDisplay");
const barFill = document.getElementById("barFill");
const amountInput = document.getElementById("amountInput");
const descInput = document.getElementById("descInput");
const incomePreview = document.getElementById("incomePreview");
const deductionPreview = document.getElementById("deductionPreview");
const incomeLog = document.getElementById("incomeLog");
const deductionLog = document.getElementById("deductionLog");

function save() {
    store[currentFY] = { incomes, deductions };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(store));
}

function calculateTotal() {
    const inc = incomes.reduce((a, b) => a + b.amount, 0);
    const ded = deductions.reduce((a, b) => a + b.amount, 0);
    return Math.max(0, inc - ded);
}

function updateUI() {
    const total = calculateTotal();
    incomeDisplay.textContent = `$${total.toLocaleString()}`;
    const taxable = Math.max(total - BASE, 0);
    barFill.style.width = Math.min((taxable / maxRange) * 100, 100) + "%";
    renderPreviews();
    renderLogs();
    save();
}

function renderPreviews() {
    incomePreview.innerHTML = incomes.slice(-3).reverse().map(renderItem).join("");
    deductionPreview.innerHTML = deductions.slice(-3).reverse().map(renderItem).join("");
}

function renderLogs() {
    incomeLog.innerHTML = incomes.map(renderItemWithDelete("income")).join("");
    deductionLog.innerHTML = deductions.map(renderItemWithDelete("deduction")).join("");
}

function renderItem(item) {
    return `
    <div class="log-item">
        <div class="log-top"><span>$${item.amount.toLocaleString()}</span></div>
        <div class="desc">${item.desc || "—"}</div>
    </div>`;
}

function renderItemWithDelete(type) {
    return (item, i) => `
    <div class="log-item">
        <div class="log-top">
            <span>${type === "income" ? "$" : "-$"}${item.amount.toLocaleString()}</span>
            <span class="delete" onclick="deleteEntry('${type}', ${i})">✕</span>
        </div>
        <div class="desc">${item.desc || "—"}</div>
    </div>`;
}

function addIncome() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    incomes.push({ amount, desc: descInput.value, time: Date.now(), fy: currentFY });
    clearInputs();
    updateUI();
}

function addDeduction() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    deductions.push({ amount, desc: descInput.value, time: Date.now(), fy: currentFY });
    clearInputs();
    updateUI();
}

function deleteEntry(type, index) {
    type === "income" ? incomes.splice(index, 1) : deductions.splice(index, 1);
    updateUI();
}

function clearInputs() {
    amountInput.value = "";
    descInput.value = "";
}

function toggle(id) {
    document.querySelectorAll("[id^='screen']").forEach(s => s.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}

const showMain = () => toggle("screen-main");
const showIncome = () => toggle("screen-income");
const showDeductions = () => toggle("screen-deduction");

updateUI();
</script>

</body>
</html>
