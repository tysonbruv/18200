<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tax Owing Tracker</title>

<style>
:root {
    --bg: #0e0e0e;
    --panel: #161616;
    --panel-dark: #111;
    --border: #2a2a2a;
    --text: #f5f5f5;
    --muted: #7a7a7a;
    --accent: linear-gradient(90deg, #ff5f57, #ffb347);
}

* { box-sizing: border-box; }

body {
    margin: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    color: var(--text);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

.app {
    width: 420px;
    background: var(--panel);
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 0 40px rgba(0,0,0,0.6);
    max-height: 90vh;
    overflow-y: auto;
}

h1 {
    font-size: 18px;
    margin: 0 0 10px 0;
    font-weight: 600;
}

.fy-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
}

.fy-controls {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    opacity: 0.8;
}

.numbers {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.threshold {
    font-size: 13px;
    opacity: 0.7;
}

.totals {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
}

#incomeDisplay {
    font-size: 15px;
}

.bar-container {
    height: 10px;
    background: var(--border);
    border-radius: 999px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    width: 0%;
    background: var(--accent);
    transition: width 0.25s ease;
}

#marginalRate {
    font-size: 11px;
    color: var(--muted);
    text-align: right;
    margin-top: 6px;
    margin-bottom: 14px;
}

.controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 16px;
}

input, button {
    background: #0f0f0f;
    border: 1px solid #333;
    color: var(--text);
    padding: 8px;
    border-radius: 6px;
    font-size: 13px;
}

button { cursor: pointer; }
button:hover { background: #222; }

.section {
    margin-bottom: 14px;
}

.section h2 {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    margin: 0 0 6px 0;
    opacity: 0.7;
}

.log-item {
    background: var(--panel-dark);
    padding: 6px 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 13px;
}

.log-top {
    display: flex;
    justify-content: space-between;
}

.desc {
    font-size: 12px;
    opacity: 0.6;
    margin-top: 2px;
}

.hidden { display: none !important; }
</style>
</head>

<body>

<div class="app">

<h1>Tax Owing Tracker</h1>

<div class="fy-row">
    <div class="fy-controls">
        <button onclick="changeFY(-1)">←</button>
        <span id="fyText"></span>
        <button onclick="changeFY(1)">→</button>
    </div>
</div>

<div class="numbers">
    <div class="threshold">$18,200</div>
    <div class="totals">
        <div id="incomeDisplay">$0</div>
    </div>
</div>

<div class="bar-container">
    <div class="bar-fill" id="barFill"></div>
</div>

<div id="marginalRate"></div>

<div class="controls">
    <input id="amountInput" type="number" placeholder="Amount $" />
    <input id="descInput" type="text" placeholder="Description" />
    <button onclick="addIncome()">Add Income</button>
    <button onclick="addDeduction()">Add Deduction</button>
</div>

<div class="section">
    <h2>Income</h2>
    <div id="incomePreview"></div>
</div>

<div class="section">
    <h2>Deductions</h2>
    <div id="deductionPreview"></div>
</div>

</div>

<script>
const BASE = 18200;
const MAX_RANGE = 50000;
const STORAGE_KEY = "taxTrackerFY";

function getFinancialYear() {
    const d = new Date();
    const y = d.getFullYear();
    return d.getMonth() >= 6 ? `${y}-${y + 1}` : `${y - 1}-${y}`;
}

let currentFY = getFinancialYear();
let store = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

function ensureFY(fy) {
    if (!store[fy]) store[fy] = { incomes: [], deductions: [] };
}

ensureFY(currentFY);

let incomes = store[currentFY].incomes;
let deductions = store[currentFY].deductions;

const incomeDisplay = document.getElementById("incomeDisplay");
const barFill = document.getElementById("barFill");
const marginalRateEl = document.getElementById("marginalRate");
const amountInput = document.getElementById("amountInput");
const descInput = document.getElementById("descInput");
const incomePreview = document.getElementById("incomePreview");
const deductionPreview = document.getElementById("deductionPreview");

function setFYLabel() {
    document.getElementById("fyText").textContent = `Financial Year: ${currentFY}`;
}

function save() {
    store[currentFY] = { incomes, deductions };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(store));
}

function totals() {
    return {
        gross: incomes.reduce((a, b) => a + b.amount, 0),
        ded: deductions.reduce((a, b) => a + b.amount, 0)
    };
}

function getMarginalRate(incomeAfterDeductions) {
    if (incomeAfterDeductions <= 18200) return 0;
    if (incomeAfterDeductions <= 45000) return 19;
    if (incomeAfterDeductions <= 120000) return 32.5;
    if (incomeAfterDeductions <= 180000) return 37;
    return 45;
}

function updateUI() {
    const { gross, ded } = totals();
    const net = gross - ded;
    const taxable = Math.max(net - BASE, 0);

    incomeDisplay.textContent = `$${net.toLocaleString()}`;
    barFill.style.width = Math.min((taxable / MAX_RANGE) * 100, 100) + "%";

    const rate = getMarginalRate(net);
    marginalRateEl.textContent = rate > 0 ? `${rate}c` : "";

    incomePreview.innerHTML = incomes.slice(-3).reverse().map(renderItem).join("");
    deductionPreview.innerHTML = deductions.slice(-3).reverse().map(renderItem).join("");

    save();
}

function renderItem(item) {
    return `
    <div class="log-item">
        <div class="log-top">
            <span>$${item.amount.toLocaleString()}</span>
        </div>
        <div class="desc">${item.desc || "—"}</div>
    </div>`;
}

function addIncome() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    incomes.push({ amount, desc: descInput.value });
    clearInputs();
    updateUI();
}

function addDeduction() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    deductions.push({ amount, desc: descInput.value });
    clearInputs();
    updateUI();
}

function clearInputs() {
    amountInput.value = "";
    descInput.value = "";
}

function changeFY(direction) {
    const [start] = currentFY.split("-").map(Number);
    const next = start + direction;
    currentFY = `${next}-${next + 1}`;
    ensureFY(currentFY);
    incomes = store[currentFY].incomes;
    deductions = store[currentFY].deductions;
    setFYLabel();
    updateUI();
}

setFYLabel();
updateUI();
</script>

</body>
</html>
