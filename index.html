<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tax Owing Tracker</title>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0e0e0e;
    color: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

.app {
    width: 420px;
    background: #161616;
    padding: 24px;
    border-radius: 14px;
    box-shadow: 0 0 40px rgba(0,0,0,0.6);
    max-height: 90vh;
    overflow-y: auto;
}

h1 {
    font-size: 18px;
    margin-bottom: 4px;
    font-weight: 600;
    opacity: 0.9;
}

.fy-row {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 12px;
    opacity: 0.7;
    margin-bottom: 12px;
}

.fy-arrow {
    cursor: pointer;
    opacity: 0.6;
    user-select: none;
}

.fy-arrow:hover { opacity: 1; }

.fy-arrow.disabled {
    opacity: 0.25;
    pointer-events: none;
}

.numbers {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    opacity: 0.85;
    margin-bottom: 10px;
}

.bar-container {
    height: 10px;
    background: #2a2a2a;
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 18px;
}

.bar-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #ff5f57, #ffb347);
    transition: width 0.25s ease;
}

.controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 16px;
}

input, button {
    background: #0f0f0f;
    border: 1px solid #333;
    color: #fff;
    padding: 8px;
    border-radius: 6px;
    font-size: 13px;
}

button {
    cursor: pointer;
}

button:hover {
    background: #2a2a2a;
}

.section {
    margin-bottom: 14px;
}

.section h2 {
    font-size: 13px;
    opacity: 0.7;
    margin-bottom: 6px;
}

.log-item {
    background: #111;
    padding: 6px 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 13px;
}

.log-top {
    display: flex;
    justify-content: space-between;
}

.desc {
    font-size: 12px;
    opacity: 0.7;
    margin-top: 2px;
}
</style>
</head>

<body>

<div class="app">

<h1>Tax Owing Tracker</h1>

<div class="fy-row">
    <span class="fy-arrow" onclick="prevFY()">←</span>
    <span id="fyLabel">Financial Year</span>
    <span class="fy-arrow" id="nextArrow" onclick="nextFY()">→</span>
</div>

<div class="numbers">
    <div>$18,200</div>
    <div id="incomeDisplay">$0</div>
</div>

<div class="bar-container">
    <div class="bar-fill" id="barFill"></div>
</div>

<div class="controls">
    <input id="amountInput" type="number" placeholder="Amount $" />
    <input id="descInput" type="text" placeholder="Description" />
    <button onclick="addIncome()">Add Income</button>
    <button onclick="addDeduction()">Add Deduction</button>
</div>

<div class="section">
    <h2>Income</h2>
    <div id="incomePreview"></div>
</div>

<div class="section">
    <h2>Deductions</h2>
    <div id="deductionPreview"></div>
</div>

</div>

<script>
const BASE = 18200;
const MAX_RANGE = 50000;
const STORAGE_KEY = "taxTrackerFY";

/* ---------- Financial Year helpers ---------- */
function fyString(start) {
    return `${start}-${start + 1}`;
}

function getCurrentFYStart() {
    const d = new Date();
    return d.getMonth() >= 6 ? d.getFullYear() : d.getFullYear() - 1;
}

/* ---------- State ---------- */
let currentFYStart = getCurrentFYStart();
let store = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
let incomes = [];
let deductions = [];

/* ---------- DOM ---------- */
const fyLabel = document.getElementById("fyLabel");
const nextArrow = document.getElementById("nextArrow");
const incomeDisplay = document.getElementById("incomeDisplay");
const barFill = document.getElementById("barFill");
const amountInput = document.getElementById("amountInput");
const descInput = document.getElementById("descInput");
const incomePreview = document.getElementById("incomePreview");
const deductionPreview = document.getElementById("deductionPreview");

/* ---------- Core ---------- */
function loadFY() {
    const fy = fyString(currentFYStart);
    store[fy] ||= { incomes: [], deductions: [] };

    // keep only current + previous FY
    const keys = Object.keys(store).sort();
    while (keys.length > 2) delete store[keys.shift()];

    incomes = store[fy].incomes;
    deductions = store[fy].deductions;

    fyLabel.textContent = `Financial Year: ${fy}`;
    nextArrow.classList.toggle(
        "disabled",
        currentFYStart >= getCurrentFYStart()
    );

    updateUI();
}

function save() {
    store[fyString(currentFYStart)] = { incomes, deductions };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(store));
}

function calculateTotal() {
    const inc = incomes.reduce((a, b) => a + b.amount, 0);
    const ded = deductions.reduce((a, b) => a + b.amount, 0);
    return Math.max(0, inc - ded);
}

function updateUI() {
    const total = calculateTotal();
    incomeDisplay.textContent = `$${total.toLocaleString()}`;

    const taxable = Math.max(total - BASE, 0);
    barFill.style.width =
        Math.min((taxable / MAX_RANGE) * 100, 100) + "%";

    incomePreview.innerHTML = incomes
        .slice(-3)
        .reverse()
        .map(renderItem)
        .join("");

    deductionPreview.innerHTML = deductions
        .slice(-3)
        .reverse()
        .map(renderItem)
        .join("");

    save();
}

/* ---------- Rendering ---------- */
function renderItem(item) {
    return `
    <div class="log-item">
        <div class="log-top">
            <span>$${item.amount.toLocaleString()}</span>
        </div>
        <div class="desc">${item.desc || "—"}</div>
    </div>`;
}

/* ---------- Actions ---------- */
function addIncome() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    incomes.push({ amount, desc: descInput.value, time: Date.now() });
    clearInputs();
    updateUI();
}

function addDeduction() {
    const amount = Number(amountInput.value);
    if (!amount) return;
    deductions.push({ amount, desc: descInput.value, time: Date.now() });
    clearInputs();
    updateUI();
}

function clearInputs() {
    amountInput.value = "";
    descInput.value = "";
}

/* ---------- FY navigation ---------- */
function prevFY() {
    currentFYStart--;
    loadFY();
}

function nextFY() {
    if (currentFYStart < getCurrentFYStart()) {
        currentFYStart++;
        loadFY();
    }
}

/* ---------- Init ---------- */
loadFY();
</script>

</body>
</html>
