<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tax Owing Tracker</title>

<style>
:root{
 --bg:#0e0e0e;
 --panel:#161616;
 --panel-dark:#111;
 --border:#2a2a2a;
 --text:#f5f5f5;
 --muted:#9a9a9a;
 --accent:linear-gradient(90deg,#ff5f57,#ffb347);
}
*{box-sizing:border-box}
body{
 margin:0;
 height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
 background:var(--bg);
 color:var(--text);
 font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
}
.app{
 width:420px;
 background:var(--panel);
 padding:24px;
 border-radius:16px;
 box-shadow:0 0 40px rgba(0,0,0,.6);
 max-height:90vh;
 overflow-y:auto;
}
h1{margin:0 0 10px 0;font-size:18px}

.fy-row{
 display:flex;
 justify-content:space-between;
 align-items:center;
 margin-bottom:14px;
}

.fy-controls{
 display:flex;
 align-items:center;
 gap:8px;
 font-size:12px;
 opacity:.8;
}

.numbers{
 display:flex;
 justify-content:space-between;
 margin-bottom:10px;
}
.threshold{font-size:13px;opacity:.7}

.totals{
 display:flex;
 flex-direction:column;
 align-items:flex-end;
}

#incomeDisplay{font-size:15px}
#taxEstimate{font-size:11px;color:var(--muted)}

.bar-container{
 height:10px;
 background:var(--border);
 border-radius:999px;
 overflow:hidden;
 margin-bottom:4px;
}
.bar-fill{
 height:100%;
 width:0;
 background:var(--accent);
 transition:width .25s ease;
}

#taxRateLabel{
 font-size:11px;
 color:var(--muted);
 text-align:right;
 margin-bottom:14px;
}

.controls{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:8px;
 margin-bottom:16px;
}

input,button{
 background:#0f0f0f;
 border:1px solid #333;
 color:var(--text);
 padding:8px;
 border-radius:6px;
 font-size:13px;
}
button{cursor:pointer}
button:hover{background:#222}

.section{margin-bottom:14px}
.section h2{
 font-size:13px;
 margin:0 0 6px 0;
 opacity:.7;
}
.log-item{
 background:var(--panel-dark);
 padding:6px 8px;
 border-radius:6px;
 margin-bottom:6px;
 font-size:13px;
}
.log-top{
 display:flex;
 justify-content:space-between;
}
.desc{font-size:12px;opacity:.6;margin-top:2px}
.delete{
 color:#ff5f57;
 cursor:pointer;
 font-size:12px;
}

.hidden{display:none!important}

.modal-backdrop{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.6);
 display:flex;
 align-items:center;
 justify-content:center;
 z-index:999;
}
.modal{
 background:var(--panel);
 padding:20px;
 border-radius:12px;
 width:320px;
}
</style>
</head>
<body>

<div id="onboarding" class="modal-backdrop hidden">
 <div class="modal">
   <div id="slide-content"></div>
   <div style="display:flex;justify-content:flex-end;margin-top:16px;">
     <button onclick="nextSlide()">Continue</button>
   </div>
 </div>
</div>

<div id="resetModal" class="modal-backdrop hidden">
 <div class="modal">
   <div style="margin-bottom:12px">Reset financial year?</div>
   <div id="resetText" style="font-size:12px;opacity:.7;margin-bottom:16px"></div>
   <div style="display:flex;gap:8px;justify-content:flex-end">
     <button onclick="closeResetModal()">No</button>
     <button onclick="doResetFY()" style="background:#ff5f57;border-color:#ff5f57">Yes</button>
   </div>
 </div>
</div>

<div class="app">
<h1>Tax Owing Tracker</h1>

<div class="fy-row">
 <div class="fy-controls">
   <button onclick="changeFY(-1)">←</button>
   <span id="fyText"></span>
   <button onclick="changeFY(1)">→</button>
 </div>
 <div style="display:flex;gap:6px;">
   <button onclick="showOnboarding()" style="width:26px;height:26px;padding:0;">?</button>
   <button onclick="openResetModal()" style="font-size:11px;opacity:.6">Reset FY</button>
 </div>
</div>

<div class="numbers">
 <div class="threshold">$18,200 tax-free threshold</div>
 <div class="totals">
   <div id="incomeDisplay">$0</div>
   <div id="taxEstimate"></div>
 </div>
</div>

<div class="bar-container">
 <div class="bar-fill" id="barFill"></div>
</div>
<div id="taxRateLabel"></div>

<div class="controls">
 <input id="amountInput" type="number" placeholder="Amount $" min="0" step="0.01">
 <input id="descInput" type="text" placeholder="Description">
 <button onclick="addIncome()">Add Income</button>
 <button onclick="addDeduction()">Add Deduction</button>
</div>

<div class="section">
 <h2>Income</h2>
 <div id="incomePreview"></div>
</div>

<div class="section">
 <h2>Deductions</h2>
 <div id="deductionPreview"></div>
</div>
</div>

<script>

/* -------- Stage 3 Tax Brackets (2024+) -------- */
function calculateTax(income){
 if(income<=18200) return 0;
 if(income<=45000) return (income-18200)*0.16;
 if(income<=135000) return (45000-18200)*0.16+(income-45000)*0.30;
 if(income<=190000) return (45000-18200)*0.16+(135000-45000)*0.30+(income-135000)*0.37;
 return (45000-18200)*0.16+(135000-45000)*0.30+(190000-135000)*0.37+(income-190000)*0.45;
}

function currentMarginalRate(income){
 if(income<=18200) return 0;
 if(income<=45000) return 0.16;
 if(income<=135000) return 0.30;
 if(income<=190000) return 0.37;
 return 0.45;
}

/* -------- FY Logic -------- */
function getFinancialYear(){
 const d=new Date();
 const y=d.getFullYear();
 return d.getMonth()>=6?`${y}-${y+1}`:`${y-1}-${y}`;
}

let currentFY=getFinancialYear();
const STORAGE_KEY="taxTrackerFY";
let store=JSON.parse(localStorage.getItem(STORAGE_KEY))||{};
if(!store[currentFY]) store[currentFY]={incomes:[],deductions:[]};

let incomes=store[currentFY].incomes;
let deductions=store[currentFY].deductions;

function save(){
 store[currentFY]={incomes,deductions};
 localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
}

/* -------- UI -------- */
const incomeDisplay=document.getElementById("incomeDisplay");
const taxEstimate=document.getElementById("taxEstimate");
const taxRateLabel=document.getElementById("taxRateLabel");
const barFill=document.getElementById("barFill");

function setFYLabel(){
 document.getElementById("fyText").textContent=`Financial Year: ${currentFY}`;
}

function totals(){
 return{
   gross:incomes.reduce((a,b)=>a+b.amount,0),
   ded:deductions.reduce((a,b)=>a+b.amount,0)
 };
}

function updateUI(){
 const {gross,ded}=totals();
 const net=Math.max(gross-ded,0);
 const tax=calculateTax(net);

 incomeDisplay.textContent=`$${net.toLocaleString()}`;
 taxEstimate.textContent=tax>0
   ?`Estimated tax: $${tax.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`
   :"";

 const rate=currentMarginalRate(net);
 taxRateLabel.textContent=rate>0?`Marginal rate: ${(rate*100)}%`:"";

 barFill.style.width=Math.min((net/200000)*100,100)+"%";

 document.getElementById("incomePreview").innerHTML=
   incomes.map((item,i)=>renderItem(item,i,"income")).reverse().join("");

 document.getElementById("deductionPreview").innerHTML=
   deductions.map((item,i)=>renderItem(item,i,"deduction")).reverse().join("");

 save();
}

function renderItem(item,index,type){
 return `<div class="log-item">
   <div class="log-top">
     <span>$${item.amount.toLocaleString()}</span>
     <span class="delete" onclick="deleteItem('${type}',${index})">✕</span>
   </div>
   <div class="desc">${item.desc||"—"}</div>
 </div>`;
}

/* -------- Actions -------- */
function addIncome(){
 const amount=parseFloat(document.getElementById("amountInput").value);
 if(isNaN(amount)||amount<=0)return;
 incomes.push({amount,desc:document.getElementById("descInput").value.trim()});
 document.getElementById("amountInput").value="";
 document.getElementById("descInput").value="";
 updateUI();
}

function addDeduction(){
 const amount=parseFloat(document.getElementById("amountInput").value);
 if(isNaN(amount)||amount<=0)return;
 deductions.push({amount,desc:document.getElementById("descInput").value.trim()});
 document.getElementById("amountInput").value="";
 document.getElementById("descInput").value="";
 updateUI();
}

function deleteItem(type,index){
 if(type==="income") incomes.splice(index,1);
 else deductions.splice(index,1);
 updateUI();
}

function changeFY(direction){
 const [start]=currentFY.split("-").map(Number);
 const next=start+direction;
 currentFY=`${next}-${next+1}`;
 if(!store[currentFY]) store[currentFY]={incomes:[],deductions:[]};
 incomes=store[currentFY].incomes;
 deductions=store[currentFY].deductions;
 setFYLabel();
 updateUI();
}

/* -------- Reset -------- */
function openResetModal(){
 document.getElementById("resetText").textContent=`Delete all data for ${currentFY}?`;
 document.getElementById("resetModal").classList.remove("hidden");
}
function closeResetModal(){
 document.getElementById("resetModal").classList.add("hidden");
}
function doResetFY(){
 delete store[currentFY];
 localStorage.setItem(STORAGE_KEY,JSON.stringify(store));
 store[currentFY]={incomes:[],deductions:[]};
 incomes=store[currentFY].incomes;
 deductions=store[currentFY].deductions;
 closeResetModal();
 updateUI();
}

/* -------- Help Slides -------- */
const slides=[
 {html:`<h2>Income</h2><p>Money you earn from customers.</p>`},
 {html:`<h2>Deduction</h2><p>Business expenses reduce taxable income.</p>`}
];

function showOnboarding(){
 currentSlide=0;
 document.getElementById("onboarding").classList.remove("hidden");
 document.getElementById("slide-content").innerHTML=slides[currentSlide].html;
}
let currentSlide=0;
function nextSlide(){
 currentSlide++;
 if(currentSlide>=slides.length){
   document.getElementById("onboarding").classList.add("hidden");
 }else{
   document.getElementById("slide-content").innerHTML=slides[currentSlide].html;
 }
}

/* -------- Init -------- */
setFYLabel();
updateUI();

</script>
</body>
</html>
